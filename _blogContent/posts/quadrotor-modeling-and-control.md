title: "Quadrotor Mini-Rotorcraft, Part 1 : Mathematical Modeling"
date: 2015-03-14
lang: en
description: The complete dynamics of an aircraft, taking into account aero-elastic effects, flexibility of the wings, internal dynamics of the engine and the whole set of changing variables are quite complex and somewhat.
categories: 
- Control


The quad-rotor model is obtained by representing the aircraft as a solid body evolving in a three dimensional space and subject to the main thrust and three torques: pitch, roll and yaw.

The quad-rotor mini-rotorcraft is controlled by the angular speeds of four electric motors as shown in Fig. 2.1. Each motor produces a thrust and a torque, whose combination generates the main thrust, the yaw torque, the pitch torque, and the roll torque acting on the quad-rotor. 

In the following we will use the Euler-Langrange approach to obtain the dynamical model of the system. If your are not familiar with this approach you can use the Newton-Euler approach.

Let's begin by contruct the Lagrangian of our system. It's given as follow : 

$$ L(q, \dot{q}) = T_{rot} + T_{trans} - U $$

Where :

* \\( q=(\zeta, \eta)=(x,y,z,\psi, \theta, \phi) \in R^6 \\) is the generalized coordinates of the rotorcraft.

    * \\(\zeta = (x,y,z) \in R^3 \\) denotes the position vector of the center of mass of the quad-rotor relative to a fixed inertial frame. 

    * \\(\eta=(\psi, \theta, \phi)  \in R^3 \\) the rotorcraft’s Euler angles (the orientation of the rotorcraft). \\(\phi\\) is the yaw angle around the *z-axis*, \\(\theta\\) is the pitch angle around the *x-axis* and \\(\psi\\) is the roll angle around *x-axis*.

* \\(U = mgz\\) is the potential energy of the rotorcraft, 
    * \\(z\\) is the rotorcraft altitude.
    * \\(m\\) denotes the mass of the quad-rotor.
    * \\(g\\) is the acceleration due to gravity).

* \\( T_{rot} = \frac{m}{2} \dot{\zeta}^T\dot{\zeta}\\) is the rotational kinetic energy
    * \\( \zeta \\) is the vector of the angular velocity.


* \\( T_{rot} = \frac{1}{2} \dot{\Omega}^T I \dot{\Omega}\\) is the translational kinetic energy.
    * \\( \Omega \\) is the vector of the angular velocity.
    * \\( I \\) is the inertia matrix.

Good news, since the Lagrangian is defined, 50% of the work is done !. 

The angular velocity vector \\( \omega \\) resolved in the body-fixed frame is related to the gener alized velocities \\( \eta \\) by means of the standard kinematic relationship.

$$ \Omega = W_{\eta} \dot{\eta} $$

Where :

$$
W_{\eta} = \left[\begin{matrix}
                 -sin \theta & 0 & 1\\\
                 cos \theta sin \phi & cos \phi & 0\\\
                 cos \theta cos \phi  & -sin \phi & 0\\\
           \end{matrix}\right]
$$

Then :

$$
\Omega = \left[\begin{matrix}
                 \dot{\phi}-\dot{\psi}sin \theta \\\
                 \dot{\theta}cos(\phi)+\dot{\psi}cos \theta sin \phi\\\
                 \dot{\psi}cos \theta cos \phi - \dot{\theta}sin(\phi) \\\
           \end{matrix}\right]
$$

Define 

$$ J=J(\eta)=W_{\eta}^T I W_{\eta}$$

Where 

$$
I = \left[\begin{matrix}
                 I_{xx} & 0 & 0\\\
                 0 & I_{yy} & 0\\\
                 0 & 0 & I_{zz} \\\
           \end{matrix}\right]
$$

so that 

$$ T_{rot} = \frac{1}{2} \dot{\eta}^T J \dot{\eta}$$

Thus, the matrix \\(J = J(\eta)\\) acts as the inertia matrix for the full rotational kinetic energy of the quad-rotor, expressed directly in terms of the generalized coordinates \\( \eta \\).

The model of the full rotorcraft dynamics is obtained from Euler–Lagrange equa-
tions with external generalized forces.

$$
\frac{d}{dt} \left(\frac{\partial L}{\partial \dot{q}}\right) - \frac{\partial L}{\partial q} =  \left[\begin{matrix}
                 F_{\dot{\zeta}}\\\
                 \tau \\\
           \end{matrix}\right]
$$

Where 

* \\(F_{\dot{\zeta}} = R \hat{F} \in R^3 \\) is the translational force applied to the rotorcraft due to main thrust.
    * \\( \hat{F} = [0, 0, u]^T \\)
        * \\( u= \sum_{i=1}^{4} f_i\\) is the main thrust directed out of the bottom of the aircraft generated by the force \\(f_i\\) of each motor \\(M_i\\).
        * \\(f_i = k \omega_i^2\\) where \\(k_i\\) is a constant and \\(\omega\\) i is the angular speed of the *ith* motor.
    * \\(R(\psi, \theta, \phi) \in SO(3)\\) represents the orientation of the aircraft relative to a fixed inertial frame.
* \\( \tau \in R^3 \\) represents the yaw, pitch and roll moments.

    * \\( \tau = \left[ \begin{matrix}
                  \tau_{\psi} \\\
                  \tau_{\theta}  \\\
                  \tau_{\phi}   \\\
           \end{matrix} \right] 
\\)
            = 
\\(            \left[\begin{matrix}
                                 \sum_i^4 \tau_{M_i} \\\
                                 (f_2-f_4) l \\\
                                 (f_3-f_1) l   \\\
                                 \end{matrix}\right] 
\\)       

    * \\( l \\) is the distance between the motors and the center of gravity, and \\( \tau_{M_i} \\) is the moment produced by motor \\( M_i \\) around the center of gravity of the aircraft.  

Since the Lagrangian contains no cross terms in the kinematic energy combining \\(\dot{\zeta}\\) with \\(\dot{\eta}\\), the EUler-Lagrange equation can be partionned into dynamics for \\(\zeta\\) and \\(\eta\\).

The Euler–Lagrange equation for the translational motion is :

$$ \frac{d}{dt} \left\[\frac{\partial L_{trans}}{\partial \dot{\zeta}}\right] - \frac{\partial L_{trans}}{\partial \zeta} = F_{\zeta}$$


The Euler–Lagrange equation for the translational motion is :

$$ \frac{d}{dt} \left\[\frac{\partial L_{rot}}{\partial \dot{\eta}}\right] - \frac{\partial L_{rot}}{\partial \eta} = \tau$$

or 

$$ \frac{d}{dt} \left\[\dot{\eta}^T J \frac{\partial \dot{\eta}}{\partial \eta}\right] - \frac{1}{2} \frac{\partial}{\partial \eta}(\dot{\eta}^T J \dot{\eta}) = \tau$$

Thus one obtains`:

$$J \ddot{\eta} + \dot{J} \dot{\eta} -\frac{1}{2} \frac{\partial}{\partial \eta}(\dot{\eta}^T J \dot{\eta}) $$

Defining the Coriolis-centripetal vector :

$$ \tilde{V} (\eta, \dot{\eta}) = \dot{J} \dot{\eta} - \frac{1}{2} \frac{\partial}{\partial \eta}(\dot{\eta}^T J \dot{\eta}) $$

one writes :

$$ J \ddot{\eta} + \tilde{V} (\eta, \dot{\eta}) = \tau $$

but \tilde{V} (\eta, \dot{\eta}) can be expressed as 

$$ \tilde{V} (\eta, \dot{\eta}) = \left( \dot{J}  - \frac{1}{2} \frac{\partial}{\partial \eta}(\dot{\eta}^T J ) \right) \dot{\eta} = C(\eta, \dot{\eta}) \dot{\eta}$$ 

where \\( C(\eta, \dot{\eta}) \\) is referred to as the Coriolis term and contains the gyroscopic and centrifugal terms associated with the \\( \eta \\) depence of \\( J \\). This yeals 

$$ m \ddot{\zeta} + mg E_z = F_{\zeta}$$
$$ J \ddot{\eta} = \tau - C(\eta, \dot{\eta}) \dot{\eta} $$

To simplify let us take

$$ \tau = \left[ \begin{matrix}
                  \tilde\tau_{\psi} \\\
                  \tilde\tau_{\theta}  \\\
                  \tilde\tau_{\phi}   \\\
           \end{matrix} \right] 
           =
           J^{-1}(\tau - C(\eta, \dot{\eta}) \dot{\eta})
$$

Finally one obtains

$$
\begin{align}
m \ddot{x} & = u(sin \phi sin \psi + cos \phi cos \psi sin \theta ) \\\
m \ddot{y} & = u(cos \phi sos \psi sin \theta - sin \phi cos \psi )\\\
m \ddot{z} & = u cos \theta cos \phi - mg \\\
\ddot{\psi} & = \tilde\tau_{\psi} \\\
\ddot{\theta} & = \tilde\tau_{\theta} \\\
\ddot{\phi} & = \tilde\tau_{\phi}
\end{align}
$$
